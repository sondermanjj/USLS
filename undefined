<?!= include('CSS'); ?>
<script> 
  /**
  * Method to be called when the Search button is pressed
  * @param json the JSON string returned when calling getJSON from the script file
  */
  function formSubmit(json){
  
    /**
    * Takes in a string and capitalizes each word in the string
    * @param string the string to capitalize
    * @return the capitalized version of the string
    */
    function capitalize(string){
    
      var stringArray = string.split(" ");
      var newString = "";
      
      for(var i=0; i<stringArray.length; i++){
        newString += stringArray[i].charAt(0).toUpperCase() + stringArray[i].slice(1) + " ";
      }
      
      return newString.trim();
    }
  
    // Variables pointing to parts of the HTML document so that their contents can be edited
    var nameDiv = document.getElementById('nameDiv');
    var schedDiv = document.getElementById('schedDiv');
    var subHeadingDiv = document.getElementById('subHeadingDiv');
    var nameEntered = capitalize(document.getElementById('Name').value.toString());
    var houseEntered = capitalize(document.getElementById('House').value.toString().trim());
    var tableEntered = document.getElementById('Table').value.toString().trim();
    var dayEntered = document.getElementById('Day').value.toString().trim().toUpperCase();
    var timeEntered = document.getElementById('Time').value.toString().trim();
    var heading = "";
    var subHeading = "";
    
    var resultsArray = [];
    
    // Start of string containing html to display matched results
    var strSched;
    
    var length = json.length;
    
    //Search for house and day and time
    if(nameEntered === "" && timeEntered !== "" && houseEntered !== "" && dayEntered !== ""){
    
      heading = houseEntered;
      subHeading = dayEntered + " Day";
      strSched = "<table><tr><th>Name</th><th>Lunch Time</th><th>Block</th><th>Table</th></tr>";
          
      for(var index=0; index<length; index++){
          
        var day = json[index].gsx$lunchday.$t;
        var house = json[index].gsx$house.$t;
        var time = json[index].gsx$eml.$t;
          
        if(dayEntered === day && houseEntered === house && timeEntered === time){
          var dayArray = [];
          var name = json[index].gsx$firstname.$t.replace(/\s/g,'') + " " + json[index].gsx$lastname.$t.replace(/\s/g,'');
          var block = json[index].gsx$block.$t;
          var table = "";
            
          switch(time){
            case "early":
              table = json[index].gsx$table.$t;
              break;
            case "late":
              table = json[index].gsx$house.$t;
              break;
            }
            dayArray.push(name);
            dayArray.push(time);
            dayArray.push(block);
            dayArray.push(table);
            resultsArray.push(dayArray);
          }   
        }
    }
    
    //Search for Lunch Period / Time
    else if(nameEntered === "" && timeEntered !== ""){
    
      heading = capitalize(timeEntered);
      
      // Search day and time
      if(dayEntered !== ""){
      
        subHeading = dayEntered + " Day";
        strSched = "<table><tr><th>Name</th><th>Block</th><th>Table</th></tr>";
        for(var index=0; index<length; index++){
        
          var time = json[index].gsx$eml.$t;
          var day = json[index].gsx$lunchday.$t;
          
          if(timeEntered === time && dayEntered === day){
            var dayArray = [];
            var name = json[index].gsx$firstname.$t.replace(/\s/g,'') + " " + json[index].gsx$lastname.$t.replace(/\s/g,'');
            var block = json[index].gsx$block.$t;
            var table = "";
          
            switch(timeEntered){
              case "early":
                table = json[index].gsx$table.$t;
                break;
              case "late":
                table = json[index].gsx$house.$t;
                break;
            }
            dayArray.push(name);
            dayArray.push(block);
            dayArray.push(table);
            if(day !== "I"){
              resultsArray.push(dayArray);
            }
          } 
        }
      }
      
      //Search just by time
      else{
        strSched = "<table><tr><th>Name</th><th>Lunch Day</th><th>Block</th><th>Table</th></tr>";
        for(var index=0; index<length; index++){

          var time = json[index].gsx$eml.$t;
            
          if(timeEntered === time){
            var dayArray = [];
            var name = json[index].gsx$firstname.$t.replace(/\s/g,'') + " " + json[index].gsx$lastname.$t.replace(/\s/g,'');
            var day = json[index].gsx$lunchday.$t;
            var block = json[index].gsx$block.$t;
            var table = "";
          
            switch(timeEntered){
              case "early":
                table = json[index].gsx$table.$t;
                break;
              case "late":
                table = json[index].gsx$house.$t;
                break;
            }
            dayArray.push(name);
            dayArray.push(day);
            dayArray.push(block);
            dayArray.push(table);
            if(day !== "I"){
              resultsArray.push(dayArray);
            }
          }  
        }
      }
    }
    
    //Search for Lunch Day
    else if(nameEntered === "" && dayEntered !== ""){
    
      heading = dayEntered + " Day";
      
      //Search for day and table
      if(tableEntered !== ""){
      
        subHeading = "Table " + tableEntered;
        strSched = "<table><tr><th>Name</th><th>Lunch Time</th><th>Block</th></tr>";
        
        for(var index=0; index<length; index++){
          
          var day = json[index].gsx$lunchday.$t;
          var table = json[index].gsx$table.$t;
          
          if(dayEntered === day && tableEntered === table){
            var dayArray = [];
            var name = json[index].gsx$firstname.$t.replace(/\s/g,'') + " " + json[index].gsx$lastname.$t.replace(/\s/g,'');
            var time = json[index].gsx$eml.$t;
            var block = json[index].gsx$block.$t;
            
            dayArray.push(name);
            dayArray.push(time);
            dayArray.push(block);
            if(day !== "I"){
              resultsArray.push(dayArray);
            } 
          }
        }
      }
      
      //Search for day and house
      else if(houseEntered !== ""){
      
        //Search for house and day and time
        if(timeEntered !== ""){
          subHeading = houseEntered;
          strSched = "<table><tr><th>Name</th><th>Lunch Time</th><th>Block</th><th>Table</th></tr>";
          
          for(var index=0; index<length; index++){
          
            var day = json[index].gsx$lunchday.$t;
            var house = json[index].gsx$house.$t;
            var time = json[index].gsx$eml.$t;
          
            if(dayEntered === day && houseEntered === house && timeEntered === time){
              var dayArray = [];
              var name = json[index].gsx$firstname.$t.replace(/\s/g,'') + " " + json[index].gsx$lastname.$t.replace(/\s/g,'');
              var block = json[index].gsx$block.$t;
              var table = "";
            
              switch(time){
                case "early":
                  table = json[index].gsx$table.$t;
                  break;
                case "late":
                  table = json[index].gsx$house.$t;
                  break;
              }
              dayArray.push(name);
              dayArray.push(time);
              dayArray.push(block);
              dayArray.push(table);
              resultsArray.push(dayArray);
            }
            
          }
        }
        
        //Search for just day and house
        else{
          subHeading = houseEntered;
          strSched = "<table><tr><th>Name</th><th>Lunch Time</th><th>Block</th><th>Table</th></tr>";
        
          for(var index=0; index<length; index++){
          
            var day = json[index].gsx$lunchday.$t;
            var house = json[index].gsx$house.$t;
          
            if(dayEntered === day && houseEntered === house){
              var dayArray = [];
              var name = json[index].gsx$firstname.$t.replace(/\s/g,'') + " " + json[index].gsx$lastname.$t.replace(/\s/g,'');
              var time = json[index].gsx$eml.$t;
              var block = json[index].gsx$block.$t;
              var table = "";
            
              switch(time){
                case "early":
                  table = json[index].gsx$table.$t;
                  break;
                case "late":
                  table = json[index].gsx$house.$t;
                  break;
              }
              dayArray.push(name);
              dayArray.push(time);
              dayArray.push(block);
              dayArray.push(table);
              resultsArray.push(dayArray);
            }
          }
        }
      }
      
      //Search just by Day
      else{
        strSched = "<table><tr><th>Name</th><th>Lunch Time</th><th>Block</th><th>Table</th></tr>";
        for(var index=0; index<length; index++){
      
          var day = json[index].gsx$lunchday.$t;
        
          if(dayEntered === day){
            var dayArray = [];
            var name = json[index].gsx$firstname.$t.replace(/\s/g,'') + " " + json[index].gsx$lastname.$t.replace(/\s/g,'');
            var time = json[index].gsx$eml.$t;
            var block = json[index].gsx$block.$t;
            var table = "";
          
            switch(time){
              case "early":
                table = json[index].gsx$table.$t;
                break;
              case "late":
                table = json[index].gsx$house.$t;
                break;
            }
            dayArray.push(name);
            dayArray.push(time);
            dayArray.push(block);
            dayArray.push(table);
            if(day !== "I"){
              resultsArray.push(dayArray);
            }
          }  
        }
      }
 
    }
    
    //Search for House
    else if(nameEntered === "" && houseEntered !== ""){
      heading = houseEntered;
      strSched = "<table><tr><th>Name</th><th>Lunch Day</th><th>Block</th><th>Lunch Time</th><th>Table</th></tr>";
      for(var index=0; index<length; index++){
      
        var house = json[index].gsx$house.$t;
        
        if(houseEntered === house){
        var dayArray = [];
          var name = json[index].gsx$firstname.$t.replace(/\s/g,'') + " " + json[index].gsx$lastname.$t.replace(/\s/g,'');
          var time = json[index].gsx$eml.$t;
          var block = json[index].gsx$block.$t;
          var day = json[index].gsx$lunchday.$t;
          var table = "";
          
          switch(time){
            case "early":
              table = json[index].gsx$table.$t;
              break;
            case "late":
              table = json[index].gsx$house.$t;
              break;
          }
          dayArray.push(name);
          dayArray.push(day);
          dayArray.push(block);
          dayArray.push(time);
          dayArray.push(table);
          if(day !== "I"){
            resultsArray.push(dayArray);
          }
        }  
      } 
    }
    
    //Search for Table
    else if(nameEntered === "" && tableEntered !== ""){
      heading = "Table " + tableEntered;
      strSched = "<table><tr><th>Lunch Day</th><th>Name</th><th>Block</th><th>Lunch Time</th></tr>";
      for(var index=0; index<length; index++){
      
        var table = json[index].gsx$table.$t;
        
        if(tableEntered === table){
        var dayArray = [];
          var name = json[index].gsx$firstname.$t.replace(/\s/g,'') + " " + json[index].gsx$lastname.$t.replace(/\s/g,'');
          var time = json[index].gsx$eml.$t;
          var block = json[index].gsx$block.$t;
          var day = json[index].gsx$lunchday.$t;
          
          switch(time){
            case "early":
              table = json[index].gsx$table.$t;
              break;
            case "late":
              table = json[index].gsx$house.$t;
              break;
          }
          
          dayArray.push(day);
          dayArray.push(name);
          dayArray.push(block);
          dayArray.push(time);
          if(day !== "I"){
            resultsArray.push(dayArray);
          }
        }  
      } 
    }
    
    // Search for Name
    else if(nameEntered !== ""){
    
      heading = nameEntered;
      
      //Name filtered by Day
      if(dayEntered !== ""){
      
        strSched = "<table><tr><th>Block</th><th>Lunch Time</th><th>Table</th></tr>";
        subHeading = dayEntered + " Day";
      
        for(var index=0; index<length; index++){
        
          var name = json[index].gsx$firstname.$t.replace(/\s/g,'') + " " + json[index].gsx$lastname.$t.replace(/\s/g,'');
          var day = json[index].gsx$lunchday.$t;
          
          if(day === dayEntered && name === nameEntered){
            var dayArray = [];
            var block = json[index].gsx$block.$t
            var time = json[index].gsx$eml.$t;
            var table = "";
            switch(time){
              case "early":
                table = json[index].gsx$table.$t;
                break;
              case "late":
                table = json[index].gsx$house.$t;
                break;
            }
            dayArray.push(block);
            dayArray.push(time);
            dayArray.push(table);
            if(day !== "I"){
              resultsArray.push(dayArray);
            }
          }
        }
      }
      
      //Name filtered by Time
      else if(timeEntered !== ""){
      
        strSched = "<table><tr><th>Lunch Day</th><th>Block</th><th>Table</th></tr>";
        subHeading = capitalize(timeEntered);
      
        for(var index=0; index<length; index++){
        
          var name = json[index].gsx$firstname.$t.replace(/\s/g,'') + " " + json[index].gsx$lastname.$t.replace(/\s/g,''); 
          var time = json[index].gsx$eml.$t;
          
          if(time === timeEntered && name === nameEntered){
            var dayArray = [];
            var block = json[index].gsx$block.$t
            var day = json[index].gsx$lunchday.$t;
            var table = "";
            switch(time){
              case "early":
                table = json[index].gsx$table.$t;
                break;
              case "late":
                table = json[index].gsx$house.$t;
                break;
            }
            dayArray.push(day);
            dayArray.push(block);
            dayArray.push(table);
            if(day !== "I"){
              resultsArray.push(dayArray);
            }
          }
        }
      }
      
      //Name filtered by Table
      else if(tableEntered !== ""){
      
        strSched = "<table><tr><th>Lunch Day</th><th>Block</th><th>Table</th></tr>";
        subHeading = "Table " + tableEntered;
      
        for(var index=0; index<length; index++){
        
          var name = json[index].gsx$firstname.$t.replace(/\s/g,'') + " " + json[index].gsx$lastname.$t.replace(/\s/g,''); 
          var table = json[index].gsx$table.$t;
          
          if(table === tableEntered && name === nameEntered){
            var dayArray = [];
            var block = json[index].gsx$block.$t
            var day = json[index].gsx$lunchday.$t;
            dayArray.push(day);
            dayArray.push(block);
            dayArray.push(table);
            if(day !== "I"){
              resultsArray.push(dayArray);
            }
          }
        }
      }
      
      //Full schedule for named student
      else{
        strSched = "<table><tr><th>Lunch Day</th><th>Block</th><th>Lunch Time</th><th>Table</th></tr>";
        for(var index=0; index<length; index++){
          var name = json[index].gsx$firstname.$t.replace(/\s/g,'') + " " + json[index].gsx$lastname.$t.replace(/\s/g,'');
      
          if(name === nameEntered){
            var dayArray = [];
            var day = json[index].gsx$lunchday.$t;
            var block = json[index].gsx$block.$t
            var time = json[index].gsx$eml.$t;
            var table = "";
            switch(time){
              case "early":
                table = json[index].gsx$table.$t;
                break;
              case "late":
                table = json[index].gsx$house.$t;
                break;
            }
            dayArray.push(day);
            dayArray.push(block);
            dayArray.push(time);
            dayArray.push(table);
            if(day !== "I"){
              resultsArray.push(dayArray);
            }
          }
        }
      }
    }
    
    var arr = resultsArray.sort();
    
    
    for(var i=0; i<arr.length; i++){
      strSched += "<tr>";
      for(var j=0; j<arr[i].length; j++){
        strSched += "<td>" + arr[i][j] + "</td>";
      }
      strSched += "</tr>";
    }
    
    strSched += "</table>";
    
    //Set the inner HTML of the necessary components to the proper contents
    schedDiv.innerHTML = strSched;
    nameDiv.innerHTML = "<h1>" + heading + "</h1>";
    subHeadingDiv.innerHTML = "<h2>" + subHeading + "</h2>";
    document.getElementById('loadingDiv').innerHTML = "";
  }
  
</script>

<div id="searchForm">
  <form id="nameForm">
    <b>Name: </b><input id="Name" type="text" name="fullname" />
    <input id="student" type="button" onClick="google.script.run.withSuccessHandler(formSubmit).getJSON(); document.getElementById('loadingDiv').innerHTML = '<br>Loading...';" value="Search" /> 
    <br><br>
    <div class="small"><b>Advanced Search Options:</b>
    <table class="noBorder" id="searchTable">
      <tr class="noBorder">
        <td class="noBorder">House: </td>
        <td class="noBorder"><input class="h" id="House" type="text" name="house" /></td>
      </tr>
      <tr class="noBorder">
        <td class="noBorder">Table: </td>
        <td class="noBorder"><input class="h" id="Table" type="text" name="table" /></td>
      </tr>
      <tr class="noBorder">
        <td class="noBorder">Day: </td>
        <td class="noBorder"><input class="h" id="Day" type="text" name="day" /> ex: A, B, C, etc.</td> 
      </tr>
      <tr class="noBorder">
        <td class="noBorder">Time: </td>
        <td class="noBorder"><input class="h" id="Time" type="text" name="time" /> ex: early, mid, late</td>
      </tr>
    </table>
    </div>
  </form>
</div>
<div id="loadingDiv"></div>
<div id="nameDiv"></div>
<div id="subHeadingDiv"></div>
<div id="schedDiv"></div>


